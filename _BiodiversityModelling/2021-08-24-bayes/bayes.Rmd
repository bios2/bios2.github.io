---
title: "Intro to Bayesian Statistics"
description: |
  Material covered on Day 4.
author: 
  - name: Dominique Gravel
  - name: Andrew MacDonald
date: 2021-08-28
output:
  distill::distill_article:
    self_contained: false
    toc: true
    toc_float: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)


make_url <- function(pres_name){
  paste0("https://bios2.github.io/biodivmodelling2021/",
         pres_name,
         "#1")
}

slide_link <- function(pres_name){
  lnk <- paste0("[Click to view full screen](", make_url(pres_name), ")")
  knitr::asis_output(lnk)
}

```

## Bayes slides, Tuesday

```{r}
xaringanExtra::embed_xaringan("https://bios2.github.io/biodivmodelling2021/Bayes.html#1")
slide_link("Bayes")
```

## Wednesday Problem

```{r}
xaringanExtra::embed_xaringan("https://bios2.github.io/biodivmodelling2021/tree_models.html#1")
slide_link("tree_models")
```


## Generative (multilevel) models 

```{r}
xaringanExtra::embed_xaringan("https://bios2.github.io/biodivmodelling2021/generative.html#1")
slide_link("generative")
```


## MCMC methods Introduction

```{r}
xaringanExtra::embed_xaringan("https://bios2.github.io/biodivmodelling2021/mcmc_dom.html#1")
slide_link("mcmc_dom")
```



## Field data project

Try to find a conjugate prior for part of your data. If you have a two-parameter distribution (e.g. the Normal distribution) you may only be able to use a conjugate prior for one parameter. 

Estimate your distribution parameters with this approach. Do you get a similar response to previously? 


## Mixed effect model

$$
\begin{align}
y &\sim \text{Normal}(\mu, \sigma_y) \\
\mu &= \beta_0 + \beta_1 x + \alpha_{block} \\
\alpha_{block} &\sim \text{Normal}(0, \sigma_{block}) \\
\sigma_y &\sim \text{Exponential}(2) \\
\sigma_{block} &\sim  \text{Exponential}(4) \\
\beta_0 &\sim \text{Normal}(7, 0.2) \\
\beta_1 &\sim \text{Normal}(4, 0.5)
\end{align}
$$

### Answer to the problem exercise

```{r}
# Step 1. Generate data
a <- 260.6
s <- 7.57
L <- runif(100,0,100)
mu <- a*L/(a/s+L)
G <- rlnorm(100, log(mu), 0.3)
plot(L, G)

# Step 2. Likelihood function
ll_fn <- function(obs, L, a, s, logsd) {
  mu <- a*L/(a/s+L)
  ll <- log(dlnorm(obs,log(mu), logsd))    
}
aseq <- seq(200,300,length.out = 100)
ll <- numeric(100)
for(i in 1:100) ll[i] <- ll_fn(obs=G, L, aseq[i], s, logsd = 0.3)
plot(aseq, ll, type = "l")

# Step 3. Define priors
p_a <- function(a, mean_a, sd_a) dnorm(a, mean = mean_a, sd = sd_a)
p_s <- function(s, mean_s, sd_s) dnorm(s, mean = mean_s, sd = sd_s)
p_logsd <- function(logsd, lo, hi) dunif(logsd, lo, hi)
```

