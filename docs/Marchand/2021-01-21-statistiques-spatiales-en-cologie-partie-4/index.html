<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>BIOS2 Education resources: Statistiques spatiales en écologie, Partie 4</title>

<meta property="description" itemprop="description" content="Introduction aux statistiques spatiales offerte par Philippe Marchand aux boursiers BIOS2 en janvier 2021. Dans les parties précédentes, nous avons vu comment prendre en compte la dépendance spatiale dans les modèles de régression linéaire avec des modèles géostatistiques (aussi appelés processus Gaussiens) ou des modèles d&#39;autocorrélation spatiale (CAR/SAR). Dans cette dernière partie, nous verrons comment combiner ces caractéristiques avec des modèles de régression plus complexes, en particulier les modèles linéaires mixtes généralisés (GLMM)."/>

<link rel="canonical" href="https://bios2.github.io/bios2_trainings/Marchand/2021-01-21-statistiques-spatiales-en-cologie-partie-4/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-01-21"/>
<meta property="article:created" itemprop="dateCreated" content="2021-01-21"/>
<meta name="article:author" content="Philippe Marchand"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="BIOS2 Education resources: Statistiques spatiales en écologie, Partie 4"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Introduction aux statistiques spatiales offerte par Philippe Marchand aux boursiers BIOS2 en janvier 2021. Dans les parties précédentes, nous avons vu comment prendre en compte la dépendance spatiale dans les modèles de régression linéaire avec des modèles géostatistiques (aussi appelés processus Gaussiens) ou des modèles d&#39;autocorrélation spatiale (CAR/SAR). Dans cette dernière partie, nous verrons comment combiner ces caractéristiques avec des modèles de régression plus complexes, en particulier les modèles linéaires mixtes généralisés (GLMM)."/>
<meta property="og:url" content="https://bios2.github.io/bios2_trainings/Marchand/2021-01-21-statistiques-spatiales-en-cologie-partie-4/"/>
<meta property="og:image" content="https://bios2.github.io/bios2_trainings/Marchand/2021-01-21-statistiques-spatiales-en-cologie-partie-4/statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-3-1.png"/>
<meta property="og:image:width" content="1248"/>
<meta property="og:image:height" content="768"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="BIOS2 Education resources"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="BIOS2 Education resources: Statistiques spatiales en écologie, Partie 4"/>
<meta property="twitter:description" content="Introduction aux statistiques spatiales offerte par Philippe Marchand aux boursiers BIOS2 en janvier 2021. Dans les parties précédentes, nous avons vu comment prendre en compte la dépendance spatiale dans les modèles de régression linéaire avec des modèles géostatistiques (aussi appelés processus Gaussiens) ou des modèles d&#39;autocorrélation spatiale (CAR/SAR). Dans cette dernière partie, nous verrons comment combiner ces caractéristiques avec des modèles de régression plus complexes, en particulier les modèles linéaires mixtes généralisés (GLMM)."/>
<meta property="twitter:url" content="https://bios2.github.io/bios2_trainings/Marchand/2021-01-21-statistiques-spatiales-en-cologie-partie-4/"/>
<meta property="twitter:image" content="https://bios2.github.io/bios2_trainings/Marchand/2021-01-21-statistiques-spatiales-en-cologie-partie-4/statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-3-1.png"/>
<meta property="twitter:image:width" content="1248"/>
<meta property="twitter:image:height" content="768"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="BIOS2 Education resources: Statistiques spatiales en écologie, Partie 4"/>
<meta name="citation_fulltext_html_url" content="https://bios2.github.io/bios2_trainings/Marchand/2021-01-21-statistiques-spatiales-en-cologie-partie-4/"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2021/01/21"/>
<meta name="citation_publication_date" content="2021/01/21"/>
<meta name="citation_author" content="Philippe Marchand"/>
<meta name="citation_author_institution" content="Université du Québec en Abitibi-Témiscamingue"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["creative_commons","title","description","author","categories","date","output","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["Statistiques spatiales en écologie, Partie 4"]},{"type":"character","attributes":{},"value":["Introduction aux statistiques spatiales offerte par Philippe Marchand aux boursiers BIOS2 en janvier 2021. Dans les parties précédentes, nous avons vu comment prendre en compte la dépendance spatiale dans les modèles de régression linéaire avec des modèles géostatistiques (aussi appelés processus Gaussiens) ou des modèles d'autocorrélation spatiale (CAR/SAR). Dans cette dernière partie, nous verrons comment combiner ces caractéristiques avec des modèles de régression plus complexes, en particulier les modèles linéaires mixtes généralisés (GLMM)."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation"]}},"value":[{"type":"character","attributes":{},"value":["Philippe Marchand"]},{"type":"character","attributes":{},"value":["Université du Québec en Abitibi-Témiscamingue"]}]}]},{"type":"character","attributes":{},"value":["Technical","Français"]},{"type":"character","attributes":{},"value":["01-21-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_float"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["https://bios2.github.io/bios2_trainings/Marchand/2021-01-21-statistiques-spatiales-en-cologie-partie-4/"]},{"type":"character","attributes":{},"value":["https://bios2.github.io/bios2_trainings/Marchand/2021-01-21-statistiques-spatiales-en-cologie-partie-4/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["data/gambia_pred.csv","data/gambia.csv","data/rls_covid.dbf","data/rls_covid.prj","data/rls_covid.shp","data/rls_covid.shx","statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-14-1.png","statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-14-2.png","statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-15-1.png","statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-17-1.png","statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-18-1.png","statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-22-1.png","statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-23-1.png","statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-3-1.png","statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-8-1.png","statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-9-1.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.7/header-attrs.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Statistiques spatiales en écologie, Partie 4","description":"Introduction aux statistiques spatiales offerte par Philippe Marchand aux boursiers BIOS2 en janvier 2021. Dans les parties précédentes, nous avons vu comment prendre en compte la dépendance spatiale dans les modèles de régression linéaire avec des modèles géostatistiques (aussi appelés processus Gaussiens) ou des modèles d'autocorrélation spatiale (CAR/SAR). Dans cette dernière partie, nous verrons comment combiner ces caractéristiques avec des modèles de régression plus complexes, en particulier les modèles linéaires mixtes généralisés (GLMM).","authors":[{"author":"Philippe Marchand","authorURL":"#","affiliation":"Université du Québec en Abitibi-Témiscamingue","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-01-21T00:00:00.000+00:00","citationText":"Marchand, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">BIOS2 Education resources</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Longer Trainings
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../Marchand.html">Spatial Statistics</a>
</div>
</div>
<a href="../../about.html">About</a>
<a href="https://github.com/bios2/bios2.github.io">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Statistiques spatiales en écologie, Partie 4</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../Marchand.html#category:Technical" class="dt-tag">Technical</a>
  <a href="../../Marchand.html#category:Français" class="dt-tag">Français</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>Introduction aux statistiques spatiales offerte par Philippe Marchand aux boursiers BIOS2 en janvier 2021. Dans les parties précédentes, nous avons vu comment prendre en compte la dépendance spatiale dans les modèles de régression linéaire avec des modèles géostatistiques (aussi appelés processus Gaussiens) ou des modèles d’autocorrélation spatiale (CAR/SAR). Dans cette dernière partie, nous verrons comment combiner ces caractéristiques avec des modèles de régression plus complexes, en particulier les modèles linéaires mixtes généralisés (GLMM).</p></p>
</div>

<div class="d-byline">
  Philippe Marchand  (Université du Québec en Abitibi-Témiscamingue)
  
<br/>01-21-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#glmm-avec-processus-spatial-gaussien">GLMM avec processus spatial gaussien</a>
<ul>
<li><a href="#données">Données</a></li>
<li><a href="#glmm-non-spatial">GLMM non spatial</a></li>
<li><a href="#glmm-spatial-avec-spamm">GLMM spatial avec spaMM</a></li>
<li><a href="#processus-gaussiens-vs.-splines-de-lissage">Processus gaussiens vs. splines de lissage</a></li>
<li><a href="#méthodes-bayésiennes-pour-les-glmm-avec-processus-gaussiens">Méthodes bayésiennes pour les GLMM avec processus gaussiens</a></li>
</ul></li>
<li><a href="#glmm-avec-autorégression-spatiale">GLMM avec autorégression spatiale</a></li>
<li><a href="#référence">Référence</a></li>
</ul>
</nav>
</div>
<p>Dans les parties précédentes, nous avons vu comment tenir compte de la dépendance spatiale dans les modèles de régression linéaire avec des modèles géostatistiques (également appelés processus gaussiens) ou des modèles d’autocorrélation spatiale (CAR/SAR). Dans cette dernière partie, nous verrons comment combiner ces caractéristiques avec des modèles de régression plus complexes, en particulier les modèles linéaires généralisés à effets mixtes (GLMM).</p>
<h1 id="glmm-avec-processus-spatial-gaussien">GLMM avec processus spatial gaussien</h1>
<h2 id="données">Données</h2>
<p>Le jeu de données <code>gambia</code> inclus avec le package <em>geoR</em> présente les résultats d’une étude sur la prévalence du paludisme chez les enfants de 65 villages en Gambie. Nous utiliserons une version légèrement transformée des données contenues dans le fichier <a href="data/gambia.csv">gambia.csv</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.leg.ufpr.br/geoR'>geoR</a></span><span class='op'>)</span>

<span class='va'>gambia</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='st'>"data/gambia.csv"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/geoR/man/head.html'>head</a></span><span class='op'>(</span><span class='va'>gambia</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  id_village        x        y pos  age netuse treated green phc
1          1 349.6313 1458.055   1 1783      0       0 40.85   1
2          1 349.6313 1458.055   0  404      1       0 40.85   1
3          1 349.6313 1458.055   0  452      1       0 40.85   1
4          1 349.6313 1458.055   1  566      1       0 40.85   1
5          1 349.6313 1458.055   0  598      1       0 40.85   1
6          1 349.6313 1458.055   1  590      1       0 40.85   1</code></pre>
</div>
<p>Voici les champs de ce jeu de données:</p>
<ul>
<li><em>id_village</em>: Identifiant du village.</li>
<li><em>x</em> and <em>y</em>: Coordonnées spatiales du village (en km, basé sur les coordonnées UTM).</li>
<li><em>pos</em>: Réponse binaire, si l’enfant a eu un test positif du paludisme.</li>
<li><em>age</em>: Âge de l’enfant en jours.</li>
<li><em>netuse</em>: Si l’enfant dort sous un moustiquaire ou non.</li>
<li><em>treated</em>: Si le moustiquaire est traité ou non.</li>
<li><em>green</em>: Mesure de la végétation basée sur les données de télédétection (disponible à l’échelle du village).</li>
<li><em>phc</em>: Présence ou absence d’un centre de santé publique pour le village.</li>
</ul>
<p>Nous pouvons compter le nombre de cas positifs et le nombre total d’enfants testés par village pour cartographier la fraction des cas positifs (ou prévalence, <em>prev</em>).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Jeu de données à l'échelle du village</span>
<span class='va'>gambia_agg</span> <span class='op'>&lt;-</span> <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>gambia</span>, <span class='va'>id_village</span>, <span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>green</span>, <span class='va'>phc</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>summarize</span><span class='op'>(</span>pos <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>pos</span><span class='op'>)</span>, total <span class='op'>=</span> <span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>prev <span class='op'>=</span> <span class='va'>pos</span> <span class='op'>/</span> <span class='va'>total</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/geoR/man/head.html'>head</a></span><span class='op'>(</span><span class='va'>gambia_agg</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 6 x 8
  id_village     x     y green   phc   pos total  prev
       &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
1          1  350. 1458.  40.8     1    17    33 0.515
2          2  359. 1460.  40.8     1    19    63 0.302
3          3  360. 1460.  40.1     0     7    17 0.412
4          4  364. 1497.  40.8     0     8    24 0.333
5          5  366. 1460.  40.8     0    10    26 0.385
6          6  367. 1463.  40.8     0     7    18 0.389</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot</span><span class='op'>(</span><span class='va'>gambia_agg</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>prev</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_path</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>gambia.borders</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span> <span class='op'>/</span> <span class='fl'>1000</span>, y <span class='op'>=</span> <span class='va'>y</span> <span class='op'>/</span> <span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>coord_fixed</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>theme_minimal</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>scale_color_viridis_c</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-3-1.png" width="624" /></p>
</div>
<p>Nous utilisons le jeu de données <code>gambia.borders</code> du package <em>geoR</em> pour tracer les frontières des pays avec <code>geom_path</code>. Comme ces frontières sont en mètres, nous les divisons par 1000 pour obtenir la même échelle que nos points. Nous utilisons également <code>coord_fixed</code> pour assurer un rapport d’aspect de 1:1 entre les axes et utilisons la palette de couleur <code>viridis</code>, qui permet de visualiser plus facilement une variable continue par rapport à la palette par défaut dans <em>ggplot2</em>.</p>
<p>Sur la base de cette carte, il semble y avoir une corrélation spatiale dans la prévalence du paludisme, le groupe de villages de l’est montrant des valeurs de prévalence plus élevées (jaune-vert) et le groupe du milieu montrant des valeurs de prévalence plus faibles (violet).</p>
<h2 id="glmm-non-spatial">GLMM non spatial</h2>
<p>Pour ce premier exemple, nous allons ignorer l’aspect spatial des données et modéliser la présence du paludisme (<em>pos</em>) en fonction de l’utilisation d’une moustiquaire (<em>netuse</em>) et de la présence d’un centre de santé publique (<em>phc</em>). Comme nous avons une réponse binaire, nous devons utiliser un modèle de régression logistique (un GLM). Comme nous avons des prédicteurs au niveau individuel et au niveau du village et que nous nous attendons à ce que les enfants d’un même village aient une probabilité plus similaire d’avoir le paludisme même après avoir pris en compte ces prédicteurs, nous devons ajouter un effet aléatoire du village. Le résultat est un GLMM que nous ajustons en utilisant la fonction <code>glmer</code> du package <em>lme4</em>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/lme4/lme4/'>lme4</a></span><span class='op'>)</span>

<span class='va'>mod_glmm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/glmer.html'>glmer</a></span><span class='op'>(</span><span class='va'>pos</span> <span class='op'>~</span> <span class='va'>netuse</span> <span class='op'>+</span> <span class='va'>phc</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>|</span> <span class='va'>id_village</span><span class='op'>)</span>, 
                  data <span class='op'>=</span> <span class='va'>gambia</span>, family <span class='op'>=</span> <span class='va'>binomial</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>mod_glmm</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Generalized linear mixed model fit by maximum likelihood (Laplace
  Approximation) [glmerMod]
 Family: binomial  ( logit )
Formula: pos ~ netuse + phc + (1 | id_village)
   Data: gambia

     AIC      BIC   logLik deviance df.resid 
  2428.0   2450.5  -1210.0   2420.0     2031 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.1286 -0.7120 -0.4142  0.8474  3.3434 

Random effects:
 Groups     Name        Variance Std.Dev.
 id_village (Intercept) 0.8149   0.9027  
Number of obs: 2035, groups:  id_village, 65

Fixed effects:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   0.1491     0.2297   0.649   0.5164    
netuse       -0.6044     0.1442  -4.190 2.79e-05 ***
phc          -0.4985     0.2604  -1.914   0.0556 .  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Correlation of Fixed Effects:
       (Intr) netuse
netuse -0.422       
phc    -0.715 -0.025</code></pre>
</div>
<p>D’après ces résultats, les variables <em>netuse</em> et <em>phc</em> sont toutes deux associées à une diminution de la prévalence du paludisme, bien que l’effet de <em>phc</em> ne soit pas significatif à un seuil <span class="math inline">\(\alpha = 0.05\)</span>. L’ordonnée à l’origine (0.149) est le logit de la probabilité de présence du paludisme pour un enfant sans moustiquaire et sans centre de santé publique, mais c’est l’ordonnée à l’origine moyenne pour tous les villages. Il y a beaucoup de variation entre les villages selon l’écart-type de l’effet aléatoire (0.90). Nous pouvons obtenir l’ordonnée à l’origine estimée pour chaque village avec la fonction <code>coef</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/geoR/man/head.html'>head</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>mod_glmm</span><span class='op'>)</span><span class='op'>$</span><span class='va'>id_village</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  (Intercept)     netuse        phc
1  0.93727515 -0.6043602 -0.4984835
2  0.09204843 -0.6043602 -0.4984835
3  0.22500620 -0.6043602 -0.4984835
4 -0.46271089 -0.6043602 -0.4984835
5  0.13680037 -0.6043602 -0.4984835
6 -0.03723346 -0.6043602 -0.4984835</code></pre>
</div>
<p>Par exemple, l’ordonnée à l’origine pour le village 1 est environ 0.94, équivalente à une probabilité de 72%:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='fl'>0.937</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.7184933</code></pre>
</div>
<p>tandis que celle pour le village 2 est équivalente à une probabilité de 52%:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='fl'>0.092</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.5229838</code></pre>
</div>
<p>Le <a href="https://cran.r-project.org/web/packages/DHARMa/vignettes/DHARMa.html">package DHARMa</a> fournit une méthode générale pour vérifier si les résidus d’un GLMM sont distribués selon le modèle spécifié et s’il existe une tendance résiduelle. Il simule des réplicats de chaque observation selon le modèle ajusté et détermine ensuite un “résidu standardisé”, qui est la position relative de la valeur observée par rapport aux valeurs simulées, par exemple 0 si l’observation est plus petite que toutes les simulations, 0.5 si elle se trouve au milieu, etc. Si le modèle représente bien les données, chaque valeur du résidu standardisé entre 0 et 1 doit avoir la même probabilité, de sorte que les résidus standardisés doivent produire une distribution uniforme entre 0 et 1.</p>
<p>La fonction <code>simulateResiduals</code> effectue le calcul des résidus standardisés, puis la fonction <code>plot</code> trace les graphiques de diagnostic avec les résultats de certains tests.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://florianhartig.github.io/DHARMa/'>DHARMa</a></span><span class='op'>)</span>
<span class='va'>res_glmm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/DHARMa/man/simulateResiduals.html'>simulateResiduals</a></span><span class='op'>(</span><span class='va'>mod_glmm</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>res_glmm</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-8-1.png" width="624" /></p>
</div>
<p>Le graphique de gauche est un graphique quantile-quantile des résidus standardisés. Les résultats de trois tests statistiques sont également présentés: un test de Kolmogorov-Smirnov (<em>KS</em>) qui vérifie s’il y a un écart par rapport à la distribution théorique, un test de dispersion qui vérifie s’il y a une sous-dispersion ou une surdispersion et un test de valeurs aberrantes (<em>outlier</em>) basé sur le nombre de résidus qui sont plus extrêmes que toutes les simulations. Ici, nous obtenons un résultat significatif pour les valeurs aberrantes, bien que le message indique que ce résultat pourrait avoir un taux d’erreur de type I plus grand que prévu dans ce cas.</p>
<p>À droite, nous obtenons généralement un graphique des résidus standardisés (en <em>y</em>) en fonction du rang des valeurs prédites, afin de vérifier l’absence de tendance résiduelle. Ici, les prédictions sont regroupées par quartile, il serait donc préférable d’agréger les prédictions et les résidus par village, ce que nous pouvons faire avec la fonction <code>recalculateResiduals</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/DHARMa/man/recalculateResiduals.html'>recalculateResiduals</a></span><span class='op'>(</span><span class='va'>res_glmm</span>, group <span class='op'>=</span> <span class='va'>gambia</span><span class='op'>$</span><span class='va'>id_village</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-9-1.png" width="624" /></p>
</div>
<p>Le graphique de droite montre les points individuels, ainsi qu’une régression quantile pour le 1er quartile, la médiane et le 3e quartile. En théorie, ces trois courbes devraient être des lignes droites horizontales (pas de tendance des résidus par rapport aux prévisions). La courbe pour le 3e quartile (en rouge) est significativement différente d’une ligne horizontale, ce qui pourrait indiquer un effet systématique manquant dans le modèle.</p>
<h2 id="glmm-spatial-avec-spamm">GLMM spatial avec spaMM</h2>
<p>Le package <em>spaMM</em> (modèles mixtes spatiaux) est un package R relativement récent qui permet d’effectuer une estimation approximative du maximum de vraisemblance des paramètres pour les GLM avec dépendance spatiale, modélisés soit comme un processus gaussien, soit avec un CAR (nous verrons ce dernier dans la dernière section). Le package implémente différents algorithmes, mais il existe une fonction unique <code>fitme</code> qui choisit l’algorithme approprié pour chaque type de modèle. Par exemple, voici le même modèle (non spatial) que nous avons vu ci-dessus, ajusté avec <em>spaMM</em>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://www.r-project.org'>spaMM</a></span><span class='op'>)</span>

<span class='va'>mod_spamm_glmm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/fitme.html'>fitme</a></span><span class='op'>(</span><span class='va'>pos</span> <span class='op'>~</span> <span class='va'>netuse</span> <span class='op'>+</span> <span class='va'>phc</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>|</span> <span class='va'>id_village</span><span class='op'>)</span>,
                        data <span class='op'>=</span> <span class='va'>gambia</span>, family <span class='op'>=</span> <span class='va'>binomial</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/summary.HL.html'>summary</a></span><span class='op'>(</span><span class='va'>mod_spamm_glmm</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>formula: pos ~ netuse + phc + (1 | id_village)
Estimation of lambda by Laplace ML approximation (p_v).
Estimation of fixed effects by Laplace ML approximation (p_v).
family: binomial( link = logit ) 
 ------------ Fixed effects (beta) ------------
            Estimate Cond. SE t-value
(Intercept)   0.1491   0.2287  0.6519
netuse       -0.6045   0.1420 -4.2567
phc          -0.4986   0.2593 -1.9231
 --------------- Random effects ---------------
Family: gaussian( link = identity ) 
           --- Variance parameters (&#39;lambda&#39;):
lambda = var(u) for u ~ Gaussian; 
   id_village  :  0.8151  
             --- Coefficients for log(lambda):
      Group        Term Estimate Cond.SE
 id_village (Intercept)  -0.2045  0.2008
# of obs: 2035; # of groups: id_village, 65 
 ------------- Likelihood values  -------------
                        logLik
p_v(h) (marginal L): -1210.016</code></pre>
</div>
<p>Notez que les estimés des effets fixes ainsi que la variance des effets aléatoires sont presque identiques à ceeux obtenues par <code>glmer</code> ci-dessus.</p>
<p>Nous pouvons maintenant utiliser <em>spaMM</em> pour ajuster le même modèle avec l’ajout de corrélations spatiales entre les villages. Dans la formule du modèle, ceci est représenté comme un effet aléatoire <code>Matern(1 | x + y)</code>, ce qui signifie que les ordonnées à l’origine sont spatialement corrélées entre les villages suivant une fonction de corrélation de Matérn des coordonnées (<em>x, y</em>). La fonction de Matérn est une fonction flexible de corrélation spatiale qui comprend un paramètre de forme <span class="math inline">\(\nu\)</span> (<code>nu</code>), de sorte que lorsque <span class="math inline">\(\nu = 0,5\)</span>, elle est équivalente à la corrélation exponentielle, mais quand <span class="math inline">\(\nu\)</span> prend de grandes valeurs, elle se rapproche d’une corrélation gaussienne. Nous pourrions laisser la fonction estimer <span class="math inline">\(\nu\)</span>, mais ici nous le fixons à 0.5 avec l’argument <code>fixed</code> de <code>fitme</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mod_spamm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/fitme.html'>fitme</a></span><span class='op'>(</span><span class='va'>pos</span> <span class='op'>~</span> <span class='va'>netuse</span> <span class='op'>+</span> <span class='va'>phc</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/Matern.corr.html'>Matern</a></span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>|</span> <span class='va'>x</span> <span class='op'>+</span> <span class='va'>y</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>|</span> <span class='va'>id_village</span><span class='op'>)</span>,
                   data <span class='op'>=</span> <span class='va'>gambia</span>, family <span class='op'>=</span> <span class='va'>binomial</span>, fixed <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>nu <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/summary.HL.html'>summary</a></span><span class='op'>(</span><span class='va'>mod_spamm</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>formula: pos ~ netuse + phc + Matern(1 | x + y) + (1 | id_village)
Estimation of lambda and corrPars by Laplace ML approximation (p_v).
Estimation of fixed effects by Laplace ML approximation (p_v).
family: binomial( link = logit ) 
 ------------ Fixed effects (beta) ------------
            Estimate Cond. SE t-value
(Intercept)  0.06861   0.3351  0.2047
netuse      -0.51719   0.1407 -3.6758
phc         -0.44416   0.2052 -2.1648
 --------------- Random effects ---------------
Family: gaussian( link = identity ) 
                   --- Correlation parameters:
      1.nu      1.rho 
0.50000000 0.05128915 
           --- Variance parameters (&#39;lambda&#39;):
lambda = var(u) for u ~ Gaussian; 
   x + y  :  0.6421 
   id_village  :  0.1978  
             --- Coefficients for log(lambda):
      Group        Term Estimate Cond.SE
      x + y (Intercept)   -0.443  0.2919
 id_village (Intercept)    -1.62  0.3166
# of obs: 2035; # of groups: x + y, 65; id_village, 65 
 ------------- Likelihood values  -------------
                        logLik
p_v(h) (marginal L): -1197.968</code></pre>
</div>
<p>Commençons par vérifier les effets aléatoires du modèle. La fonction de corrélation spatiale a un paramètre <code>rho</code> égal à 0.0513. Ce paramètre dans <em>spaMM</em> est l’inverse de la portée, donc ici la portée de la corrélation exponentielle est de 1/0.0513 ou environ 19.5 km. Il y a maintenant deux pramètres de variance, celui identifié comme <code>x + y</code> est la variance à longue distance (i.e. le palier) pour le modèle de corrélation exponentielle alors que celui identifié comme <code>id_village</code> montre la portion non corrélée de la variation entre les villages.</p>
<p>Si nous avions ici laissé les effets aléatoires <code>(1 | id_village)</code> dans la formule pour représenter la partie non spatiale de la variation entre les villages, nous pourrions également représenter ceci avec un effet de pépite dans le modèle géostatistique. Dans les deux cas, cela représenterait l’idée que même deux villages très proches l’un de l’autre auraient des prévalences de base différentes dans le modèle.</p>
<p>Par défaut, la fonction <code>Matern</code> n’a pas d’effet de pépite, mais nous pouvons en ajouter un en spécifiant une <code>pépite</code> non nulle dans la liste initiale des paramètres <code>init</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mod_spamm2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/fitme.html'>fitme</a></span><span class='op'>(</span><span class='va'>pos</span> <span class='op'>~</span> <span class='va'>netuse</span> <span class='op'>+</span> <span class='va'>phc</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/Matern.corr.html'>Matern</a></span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>|</span> <span class='va'>x</span> <span class='op'>+</span> <span class='va'>y</span><span class='op'>)</span>,
                    data <span class='op'>=</span> <span class='va'>gambia</span>, family <span class='op'>=</span> <span class='va'>binomial</span>, fixed <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>nu <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>,
                    init <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>Nugget <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/summary.HL.html'>summary</a></span><span class='op'>(</span><span class='va'>mod_spamm2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>formula: pos ~ netuse + phc + Matern(1 | x + y)
Estimation of lambda and corrPars by Laplace ML approximation (p_v).
Estimation of fixed effects by Laplace ML approximation (p_v).
family: binomial( link = logit ) 
 ------------ Fixed effects (beta) ------------
            Estimate Cond. SE t-value
(Intercept)  0.06861   0.3352  0.2047
netuse      -0.51719   0.1407 -3.6758
phc         -0.44416   0.2052 -2.1648
 --------------- Random effects ---------------
Family: gaussian( link = identity ) 
                   --- Correlation parameters:
      1.nu   1.Nugget      1.rho 
0.50000000 0.23551424 0.05128739 
           --- Variance parameters (&#39;lambda&#39;):
lambda = var(u) for u ~ Gaussian; 
   x + y  :  0.8399  
             --- Coefficients for log(lambda):
 Group        Term Estimate Cond.SE
 x + y (Intercept)  -0.1744  0.2146
# of obs: 2035; # of groups: x + y, 65 
 ------------- Likelihood values  -------------
                        logLik
p_v(h) (marginal L): -1197.968</code></pre>
</div>
<p>Comme vous pouvez le voir, toutes les estimations sont les mêmes, sauf que la variance de la portion spatiale (palier) est maintenant de 0.84 et que la pépite est égale à une fraction 0.235 de ce palier, soit une variance de 0.197, ce qui est identique à l’effet aléatoire <code>id_village</code> dans la version ci-dessus. Les deux formulations sont donc équivalentes.</p>
<p>Maintenant, rappelons les coefficients que nous avions obtenus pour le GLMM non spatial :</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/summary.HL.html'>summary</a></span><span class='op'>(</span><span class='va'>mod_glmm</span><span class='op'>)</span><span class='op'>$</span><span class='va'>coefficients</span>
</code></pre>
</div>
<pre><code>              Estimate Std. Error    z value     Pr(&gt;|z|)
(Intercept)  0.1490596  0.2297164  0.6488855 5.164124e-01
netuse      -0.6043602  0.1442451 -4.1898129 2.791846e-05
phc         -0.4984835  0.2604289 -1.9140866 5.560909e-02</code></pre>
</div>
<p>Dans la version spatiale, les deux effets fixes se sont légèrement rapprochés de zéro, mais l’erreur-type de l’effet de <code>phc</code> a diminué. Il est intéressant de noter que l’inclusion de la dépendance spatiale nous a permis d’estimer plus précisément l’effet de la présence d’un centre de santé publique dans le village. Ce ne serait pas toujours le cas: pour un prédicteur qui est également fortement corrélé dans l’espace, la corrélation spatiale dans la réponse rend plus difficile l’estimation de l’effet de ce prédicteur, puisqu’il est confondu avec l’effet spatial. Cependant, pour un prédicteur qui n’est pas corrélé dans l’espace, l’inclusion de l’effet spatial réduit la variance résiduelle (non spatiale) et peut donc augmenter la précision de l’effet du prédicteur.</p>
<p>Le package <em>spaMM</em> est également compatible avec <em>DHARMa</em> pour les diagnostics résiduels. (Vous pouvez ignorer l’avertissement selon lequel il ne fait pas partie de la classe des modèles pris en charge, cela est dû à l’utilisation de la fonction <code>fitme</code> plutôt que d’une fonction d’algorithme spécifique dans <em>spaMM</em>).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>res_spamm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/DHARMa/man/simulateResiduals.html'>simulateResiduals</a></span><span class='op'>(</span><span class='va'>mod_spamm2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/plot.HL.html'>plot</a></span><span class='op'>(</span><span class='va'>res_spamm</span><span class='op'>)</span>
</code></pre>
</div>
<img src="statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-14-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/plot.HL.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/DHARMa/man/recalculateResiduals.html'>recalculateResiduals</a></span><span class='op'>(</span><span class='va'>res_spamm</span>, group <span class='op'>=</span> <span class='va'>gambia</span><span class='op'>$</span><span class='va'>id_village</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-14-2.png" width="624" /></p>
</div>
<p>Enfin, bien que nous allons montrer comment calculer et visualiser des prédictions spatiales ci-dessous, nous pouvons produire une carte rapide des effets spatiaux estimés dans un modèle <em>spaMM</em> avec la fonction <code>filled.mapMM</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/mapMM.html'>filled.mapMM</a></span><span class='op'>(</span><span class='va'>mod_spamm2</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-15-1.png" width="624" /></p>
</div>
<h2 id="processus-gaussiens-vs.-splines-de-lissage">Processus gaussiens vs. splines de lissage</h2>
<p>Si vous connaissez bien les modèles additifs généralisés (GAM), vous avez peut-être pensé à représenter la variation spatiale de la prévalence du paludisme (comme le montre la carte ci-dessus) par une spline de lissage en 2D (en fonction de <span class="math inline">\(x\)</span> et <span class="math inline">\(y\)</span>) dans un GAM.</p>
<p>Le code ci-dessous correspond à l’équivalent GAM de notre GLMM avec processus gaussien ci-dessus, ajusté avec la fonction <code>gam</code> du package <em>mgcv</em>. L’effet spatial est représenté par la spline 2D <code>s(x, y)</code> alors que l’effet aléatoire non spatial de village est représenté par <code>s(id_village, bs = "re")</code>, qui est équivalent à <code>(1 | id_village)</code> dans les modèles précédents. Notez que pour la fonction <code>gam</code>, les variables catégorielles doivent être explicitement converties en facteurs.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>mgcv</span><span class='op'>)</span>
<span class='va'>gambia</span><span class='op'>$</span><span class='va'>id_village</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>gambia</span><span class='op'>$</span><span class='va'>id_village</span><span class='op'>)</span>
<span class='va'>mod_gam</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/mgcv/man/gam.html'>gam</a></span><span class='op'>(</span><span class='va'>pos</span> <span class='op'>~</span> <span class='va'>netuse</span> <span class='op'>+</span> <span class='va'>phc</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/mgcv/man/s.html'>s</a></span><span class='op'>(</span><span class='va'>id_village</span>, bs <span class='op'>=</span> <span class='st'>"re"</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/mgcv/man/s.html'>s</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span>, 
               data <span class='op'>=</span> <span class='va'>gambia</span>, family <span class='op'>=</span> <span class='va'>binomial</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Pour visualiser la spline en 2D, nous utiliserons le package <a href="https://fromthebottomoftheheap.net/2018/10/23/introducing-gratia/"><em>gratia</em></a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://gavinsimpson.github.io/gratia/'>gratia</a></span><span class='op'>)</span>
<span class='fu'><a href='https://gavinsimpson.github.io/gratia/reference/draw.html'>draw</a></span><span class='op'>(</span><span class='va'>mod_gam</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-17-1.png" width="624" /></p>
</div>
<p>Notez que le graphique de la spline <code>s(x, y)</code> (en haut à droite) ne s’étend pas trop loin des emplacements des données (les autres zones sont vides). Dans ce graphique, on peut également voir que les effets aléatoires des villages suivent la distribution gaussienne attendue (en haut à gauche).</p>
<p>Ensuite, nous utiliserons à la fois le GLMM spatial de la section précédente et ce GAMM pour prédire la prévalence moyenne sur une grille spatiale de points contenue dans le fichier <a href="data/gambia_pred.csv">gambia_pred.csv</a>. Le graphique ci-dessous ajoute ces points de prédiction (en noir) sur la carte précédente des points de données.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>gambia_pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='st'>"data/gambia_pred.csv"</span><span class='op'>)</span>

<span class='fu'>ggplot</span><span class='op'>(</span><span class='va'>gambia_agg</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>gambia_pred</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>prev</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_path</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>gambia.borders</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span> <span class='op'>/</span> <span class='fl'>1000</span>, y <span class='op'>=</span> <span class='va'>y</span> <span class='op'>/</span> <span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>coord_fixed</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>theme_minimal</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>scale_color_viridis_c</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-18-1.png" width="624" /></p>
</div>
<p>Pour faire des prédictions à partir du modèle GAMM à ces endroits, le code ci-dessous effectue les étapes suivantes:</p>
<ul>
<li><p>Tous les prédicteurs du modèle doivent se trouver dans le tableau de données de prédiction, nous ajoutons donc des valeurs constantes de <em>netuse</em> et <em>phc</em> (toutes deux égales à 1) pour tous les points. Ainsi, nous ferons des prédictions sur la prévalence du paludisme dans le cas où un moustiquaire est utilisée et où un centre de santé publique est présent. Nous ajoutons également un <em>id_village</em> constant, bien qu’il ne soit pas utilisé dans les prédictions (voir ci-dessous).</p></li>
<li><p>Nous appelons la fonction <code>predict</code> à la sortie de <code>gam</code> pour produire des prédictions aux nouveaux points de données (argument <code>newdata</code>), en incluant les erreurs-types (<code>se.fit = TRUE</code>) et en excluant les effets aléatoires du village, donc la prédiction est faite pour un “village moyen”. L’objet résultant <code>gam_pred</code> aura des colonnes <code>fit</code> (prédiction moyenne) et <code>se.fit</code> (erreur-type). Ces prédictions et erreurs-types sont sur l’échelle du lien (logit).</p></li>
<li><p>Nous rattachons le jeu de données de prédiction original à <code>gam_pred</code> avec <code>cbind</code>.</p></li>
<li><p>Nous ajoutons des colonnes pour la prédiction moyenne et les limites de l’intervalle de confiance à 50% (moyenne <span class="math inline">\(\pm\)</span> 0.674 erreur-type), converties de l’échelle logit à l’échelle de probabilité avec <code>plogis</code>. Nous choisissons un intervalle de 50% car un intervalle de 95% peut être trop large ici pour contraster les différentes prédictions sur la carte à la fin de cette section.</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>gambia_pred</span> <span class='op'>&lt;-</span> <span class='fu'>mutate</span><span class='op'>(</span><span class='va'>gambia_pred</span>, netuse <span class='op'>=</span> <span class='fl'>1</span>, phc <span class='op'>=</span> <span class='fl'>1</span>, id_village <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='va'>gam_pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>mod_gam</span>, newdata <span class='op'>=</span> <span class='va'>gambia_pred</span>, se.fit <span class='op'>=</span> <span class='cn'>TRUE</span>, 
                    exclude <span class='op'>=</span> <span class='st'>"s(id_village)"</span><span class='op'>)</span>
<span class='va'>gam_pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>gambia_pred</span>, <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>gam_pred</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>gam_pred</span> <span class='op'>&lt;-</span> <span class='fu'>mutate</span><span class='op'>(</span><span class='va'>gam_pred</span>, pred <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span>, 
                   lo <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='va'>fit</span> <span class='op'>-</span> <span class='fl'>0.674</span> <span class='op'>*</span> <span class='va'>se.fit</span><span class='op'>)</span>, <span class='co'># 50% CI</span>
                   hi <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='va'>fit</span> <span class='op'>+</span> <span class='fl'>0.674</span> <span class='op'>*</span> <span class='va'>se.fit</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p><em>Note</em> : La raison pour laquelle nous ne faisons pas de prédictions directement sur l’échelle de probabilité (réponse) est que la formule normale des intervalles de confiance s’applique plus précisément sur l’échelle logit. L’ajout d’un certain nombre d’erreurs-types autour de la moyenne sur l’échelle de probabilité conduirait à des intervalles moins précis et peut-être même à des intervalles de confiance en dehors de la plage de valeurs possible (0, 1) pour une probabilité.</p>
<p>Nous appliquons la même stratégie pour faire des prédictions à partir du GLMM spatial avec <em>spaMM</em>. Il y a quelques différences dans la méthode <code>predict</code> par rapport au cas du GAMM.</p>
<ul>
<li><p>L’argument <code>binding = "fit"</code> signifie que les prédictions moyennes (colonne <code>fit</code>) seront attachées à l’ensemble de données de prédiction et retournées sous forme de tableau de données <code>spamm_pred</code>.</p></li>
<li><p>L’argument <code>variances = list(linPred = TRUE)</code> indique à <code>predict</code> de calculer la variance du prédicteur linéaire (donc le carré de l’erreur-type). Cependant, il apparaît comme un attribut <code>predVar</code> dans le tableau de données de sortie plutôt que dans une colonne <code>se.fit</code>, donc nous le déplaçons vers une colonne sur la ligne suivante.</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>spamm_pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>mod_spamm</span>, newdata <span class='op'>=</span> <span class='va'>gambia_pred</span>, type <span class='op'>=</span> <span class='st'>"link"</span>,
                      binding <span class='op'>=</span> <span class='st'>"fit"</span>, variances <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>linPred <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>spamm_pred</span><span class='op'>$</span><span class='va'>se.fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>spamm_pred</span>, <span class='st'>"predVar"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>spamm_pred</span> <span class='op'>&lt;-</span> <span class='fu'>mutate</span><span class='op'>(</span><span class='va'>spamm_pred</span>, pred <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span>, 
                     lo <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='va'>fit</span> <span class='op'>-</span> <span class='fl'>0.674</span> <span class='op'>*</span> <span class='va'>se.fit</span><span class='op'>)</span>,
                     hi <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='va'>fit</span> <span class='op'>+</span> <span class='fl'>0.674</span> <span class='op'>*</span> <span class='va'>se.fit</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Enfin, nous combinons les deux ensembles de prédictions sous la forme de différentes rangées d’un tableau de données <code>pred_all</code> avec <code>bind_rows</code>. Le nom du tableau de données d’où provient chaque prédiction (<code>gam</code> ou <code>spamm</code>) apparaîtra dans la colonne “model” (argument <code>.id</code>). Pour simplifier la production du prochain graphique, nous utilisons ensuite <code>pivot_longer</code> dans le package <em>tidyr</em> pour changer les trois colonnes “pred”, “lo” et “hi” en deux colonnes, “stat” et “value” (<code>pred_tall</code> a donc trois rangées pour chaque rangée dans <code>pred_all</code>).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pred_all</span> <span class='op'>&lt;-</span> <span class='fu'>bind_rows</span><span class='op'>(</span>gam <span class='op'>=</span> <span class='va'>gam_pred</span>, spamm <span class='op'>=</span> <span class='va'>spamm_pred</span>, .id <span class='op'>=</span> <span class='st'>"model"</span><span class='op'>)</span>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyr.tidyverse.org'>tidyr</a></span><span class='op'>)</span>
<span class='va'>pred_tall</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span><span class='va'>pred_all</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>pred</span>, <span class='va'>lo</span>, <span class='va'>hi</span><span class='op'>)</span>, names_to <span class='op'>=</span> <span class='st'>"stat"</span>,
                          values_to <span class='op'>=</span> <span class='st'>"value"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Une fois ces étapes franchies, nous pouvons enfin examiner les cartes de prédiction (moyenne, limites inférieure et supérieure de l’intervalle de confiance à 50 %) à l’aide d’un graphique <code>ggplot</code>. Les points de données originaux sont indiqués en rouge.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot</span><span class='op'>(</span><span class='va'>pred_tall</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>gambia_agg</span>, color <span class='op'>=</span> <span class='st'>"red"</span>, size <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>coord_fixed</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>stat</span><span class='op'>~</span><span class='va'>model</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>scale_color_viridis_c</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>theme_minimal</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-22-1.png" width="624" /></p>
</div>
<p>Bien que les deux modèles s’accordent à dire que la prévalence est plus élevée près du groupe de villages de l’est, le GAMM estime également une prévalence plus élevée en quelques points (bord ouest et autour du centre) où il n’y a pas de données. Il s’agit d’un artefact de la forme de la spline autour des points de données, puisqu’une spline est censée correspondre à une tendance globale, bien que non linéaire. En revanche, le modèle géostatistique représente l’effet spatial sous forme de corrélations locales et revient à la prévalence moyenne globale lorsqu’il est éloigné de tout point de données, ce qui est une supposition plus sûre. C’est l’une des raisons pour lesquelles il est préférable de choisir un modèle géostatistique / processus gaussien dans ce cas.</p>
<h2 id="méthodes-bayésiennes-pour-les-glmm-avec-processus-gaussiens">Méthodes bayésiennes pour les GLMM avec processus gaussiens</h2>
<p>Les modèles bayésiens fournissent un cadre flexible pour exprimer des modèles avec une structure de dépendance complexe entre les données, y compris la dépendance spatiale. Cependant, l’ajustement d’un modèle de processus gaussien avec une approche entièrement bayésienne peut être lent, en raison de la nécessité de calculer une matrice de covariance spatiale entre toutes les paires de points à chaque itération.</p>
<p>La méthode INLA (pour <em>integrated nested Laplace approximation</em>) effectue un calcul approximatif de la distribution postérieure bayésienne, ce qui la rend adaptée aux problèmes de régression spatiale. Nous ne l’abordons pas dans ce cours, mais je recommande le manuel de Paula Moraga (dans la section des références ci-dessous) qui fournit des exemples concrets d’utilisation de la méthode INLA pour divers modèles de données géostatistiques et aréales, dans le contexte de l’épidémiologie, y compris des modèles avec une dépendance à la fois spatiale et temporelle. Le livre présente les mêmes données sur le paludisme en Gambie comme exemple d’un ensemble de données géostatistiques, ce qui a inspiré son utilisation dans ce cours.</p>
<h1 id="glmm-avec-autorégression-spatiale">GLMM avec autorégression spatiale</h1>
<p>Nous revenons au dernier exemple de la partie précédente, où nous avions modélisé le taux de cas de COVID-19 (cas / 1000) pour les divisions administratives du réseau de la santé (RLS) au Québec en fonction de leur densité de population. Le taux est donné par la colonne “taux_1k” dans le <em>shapefile</em> <code>rls_covid</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-spatial.github.io/sf/'>sf</a></span><span class='op'>)</span>
<span class='va'>rls_covid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_read.html'>read_sf</a></span><span class='op'>(</span><span class='st'>"data/rls_covid.shp"</span><span class='op'>)</span>
<span class='va'>rls_covid</span> <span class='op'>&lt;-</span> <span class='va'>rls_covid</span><span class='op'>[</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>rls_covid</span><span class='op'>$</span><span class='va'>dens_pop</span><span class='op'>)</span>, <span class='op'>]</span>
<span class='fu'><a href='https://r-spatial.github.io/sf/reference/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>rls_covid</span><span class='op'>[</span><span class='st'>"taux_1k"</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="statistiques-spatiales-en-cologie-partie-4_files/figure-html5/unnamed-chunk-23-1.png" width="624" /></p>
</div>
<p>Auparavant, nous avions modélisé le logarithme de ce taux comme une fonction linéaire du logarithme de la densité de population, la variance résiduelle étant corrélée entre les unités voisines via une structure CAR (autorégression conditionnelle), comme le montre le code ci-dessous.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/r-spatial/spdep/'>spdep</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/r-spatial/spatialreg/'>spatialreg</a></span><span class='op'>)</span>

<span class='va'>rls_nb</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/spdep/man/poly2nb.html'>poly2nb</a></span><span class='op'>(</span><span class='va'>rls_covid</span><span class='op'>)</span>
<span class='va'>rls_w</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/spdep/man/nb2listw.html'>nb2listw</a></span><span class='op'>(</span><span class='va'>rls_nb</span>, style <span class='op'>=</span> <span class='st'>"B"</span><span class='op'>)</span>

<span class='va'>car_lm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/spdep/man/spdep-deprecated.html'>spautolm</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>taux_1k</span><span class='op'>)</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>dens_pop</span><span class='op'>)</span>, data <span class='op'>=</span> <span class='va'>rls_covid</span>,
                   listw <span class='op'>=</span> <span class='va'>rls_w</span>, family <span class='op'>=</span> <span class='st'>"CAR"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/summary.HL.html'>summary</a></span><span class='op'>(</span><span class='va'>car_lm</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call: 
spautolm(formula = log(taux_1k) ~ log(dens_pop), data = rls_covid, 
    listw = rls_w, family = &quot;CAR&quot;)

Residuals:
      Min        1Q    Median        3Q       Max 
-1.201858 -0.254084 -0.053348  0.281482  1.427053 

Coefficients: 
              Estimate Std. Error z value  Pr(&gt;|z|)
(Intercept)   1.702068   0.168463 10.1035 &lt; 2.2e-16
log(dens_pop) 0.206623   0.032848  6.2903 3.169e-10

Lambda: 0.15762 LR test value: 23.991 p-value: 9.6771e-07 
Numerical Hessian standard error of lambda: 0.0050486 

Log likelihood: -80.68953 
ML residual variance (sigma squared): 0.2814, (sigma: 0.53048)
Number of observations: 95 
Number of parameters estimated: 4 
AIC: 169.38</code></pre>
</div>
<p><em>Rappel</em>: La fonction <code>poly2nb</code> du package <em>spdep</em> crée une liste de voisins basée sur les polygones limitrophes dans un <em>shapefile</em>, puis <code>nb2listw</code> la convertit en une liste de poids, ici des poids binaires (<code>style = "B"</code>) de sorte que chaque région limitrophe reçoive le même poids de 1 dans le modèle autorégressif.</p>
<p>Au lieu d’utiliser les taux, il serait possible de modéliser directement les cas avec une régression de Poisson, qui est appropriée pour les données de comptage. Pour tenir compte du fait que si le risque par personne était égal, les cas seraient proportionnels à la population, nous pouvons ajouter la population de l’unité <code>pop</code> comme <em>offset</em> dans la régression de Poisson. Par conséquent, le modèle ressemblerait à : <code>cas ~ log(dens_pop) + offset(log(pop))</code>. Notez que puisque la régression de Poisson utilise un lien logarithmique, ce modèle avec <code>log(pop)</code> comme <em>offset</em> suppose que <code>log(cas / pop)</code> (donc le taux logarithmique) est proportionnel à <code>log(dens_pop)</code>, tout comme le modèle linéaire ci-dessus, mais il a l’avantage de modéliser la variabilité des données brutes (le nombre de cas) directement avec une distribution de Poisson.</p>
<p>Nous n’avons pas la population dans ces données, mais nous pouvons l’estimer à partir des cas et du taux (cas / 1000) comme suit:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rls_covid</span><span class='op'>$</span><span class='va'>pop</span> <span class='op'>&lt;-</span> <span class='va'>rls_covid</span><span class='op'>$</span><span class='va'>cas</span> <span class='op'>/</span> <span class='va'>rls_covid</span><span class='op'>$</span><span class='va'>taux_1k</span> <span class='op'>*</span> <span class='fl'>1000</span>
</code></pre>
</div>
</div>
<p>Pour définir un modèle CAR dans <em>spaMM</em>, nous avons besoin d’une matrice de poids plutôt que d’une liste de poids comme dans le package <em>spatialreg</em>. Heureusement, le package <em>spdep</em> comprend également une fonction <code>nb2mat</code> pour convertir la liste des voisins en une matrice de poids, là encore en utilisant des poids binaires. Pour éviter un avertissement dans R, nous spécifions que les noms des lignes et des colonnes de cette matrice doivent être égaux aux identifiants associés à chaque unité (<code>RLS_code</code>). Ensuite, nous ajoutons un terme <code>adjacency(1 | RLS_code)</code> au modèle pour spécifier que la variation résiduelle entre les différents groupes définis par <code>RLS_code</code> est spatialement corrélée avec une structure CAR (ici, chaque groupe n’a qu’une observation puisque nous avons un point de données par unité RLS).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://www.r-project.org'>spaMM</a></span><span class='op'>)</span>

<span class='va'>rls_mat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/spdep/man/nb2mat.html'>nb2mat</a></span><span class='op'>(</span><span class='va'>rls_nb</span>, style <span class='op'>=</span> <span class='st'>"B"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>rls_mat</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='va'>rls_covid</span><span class='op'>$</span><span class='va'>RLS_code</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>rls_mat</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='va'>rls_covid</span><span class='op'>$</span><span class='va'>RLS_code</span>

<span class='va'>rls_spamm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/fitme.html'>fitme</a></span><span class='op'>(</span><span class='va'>cas</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>dens_pop</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/offset.html'>offset</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>pop</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/autoregressive.html'>adjacency</a></span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>|</span> <span class='va'>RLS_code</span><span class='op'>)</span>,
                   data <span class='op'>=</span> <span class='va'>rls_covid</span>, adjMatrix <span class='op'>=</span> <span class='va'>rls_mat</span>, family <span class='op'>=</span> <span class='va'>poisson</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/spaMM/man/summary.HL.html'>summary</a></span><span class='op'>(</span><span class='va'>rls_spamm</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>formula: cas ~ log(dens_pop) + offset(log(pop)) + adjacency(1 | RLS_code)
Estimation of lambda and corrPars by Laplace ML approximation (p_v).
Estimation of fixed effects by Laplace ML approximation (p_v).
family: poisson( link = log ) 
 ------------ Fixed effects (beta) ------------
              Estimate Cond. SE t-value
(Intercept)    -5.1620  0.16858 -30.621
log(dens_pop)   0.1999  0.03267   6.118
 --------------- Random effects ---------------
Family: gaussian( link = identity ) 
                   --- Correlation parameters:
    1.rho 
0.1576786 
           --- Variance parameters (&#39;lambda&#39;):
lambda = var(u) for u ~ Gaussian; 
   RLS_code  :  0.266  
             --- Coefficients for log(lambda):
    Group        Term Estimate Cond.SE
 RLS_code (Intercept)   -1.324  0.1473
# of obs: 95; # of groups: RLS_code, 95 
 ------------- Likelihood values  -------------
                        logLik
p_v(h) (marginal L): -709.3234</code></pre>
</div>
<p>Notez que le coefficient de corrélation spatiale <code>rho</code> (0.158) est similaire à la quantité équivalente dans le modèle <code>spautolm</code> ci-dessus, où il était appelé <code>Lambda</code>. L’effet de <code>log(dens_pop)</code> est également d’environ 0.2 dans les deux modèles.</p>
<h1 id="référence">Référence</h1>
<p>Moraga, Paula (2019) Geospatial Health Data: Modeling and Visualization with R-INLA and Shiny. Chapman &amp; Hall/CRC Biostatistics Series. Disponible en ligne: <a href="https://www.paulamoraga.com/book-geospatial/">https://www.paulamoraga.com/book-geospatial/</a>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="updates-and-corrections">Corrections</h3>
  <p>If you see mistakes or want to suggest changes, please <a href="https://github.com/bios2/bios2_trainings/issues/new">create an issue</a> on the source repository.</p>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. Source code is available at <a href="https://github.com/bios2/bios2_trainings">https://github.com/bios2/bios2_trainings</a>, unless otherwise noted. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Marchand (2021, Jan. 21). BIOS2 Education resources: Statistiques spatiales en écologie, Partie 4. Retrieved from https://bios2.github.io/bios2_trainings/Marchand/2021-01-21-statistiques-spatiales-en-cologie-partie-4/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{marchand2021statistiques,
  author = {Marchand, Philippe},
  title = {BIOS2 Education resources: Statistiques spatiales en écologie, Partie 4},
  url = {https://bios2.github.io/bios2_trainings/Marchand/2021-01-21-statistiques-spatiales-en-cologie-partie-4/},
  year = {2021}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
